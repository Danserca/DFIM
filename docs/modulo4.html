<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Módulo 4</title>

<script src="site_libs/header-attrs-2.20/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/spacelab.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="assets/css/styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">DFIM</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Inicio</a>
</li>
<li>
  <a href="modulo1.html">Módulo 1</a>
</li>
<li>
  <a href="modulo2.html">Módulo 2</a>
</li>
<li>
  <a href="modulo3.html">Módulo 3</a>
</li>
<li>
  <a href="modulo4.html">Módulo 4</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Módulo 4</h1>
<h3 class="subtitle">Metodología</h3>

</div>


<style type="text/css">
.navbar {
  background-color: #0077C8 !important; /* Cambia este valor para ajustar el color del cintillo */
  border-color: #0077C8 !important; /* Opcional: cambia también el color del borde si es necesario */
}


TOC {
  color: #0077C8; 
}

.list-group-item.active, .list-group-item.active:focus, .list-group-item.active:hover {
    z-index: 2;
    color: #003057;
    background-color: #0077C8;
    border-color: #0077C8;
}

hr.cintillo {
  border: 3px solid #0077C8; /* Color y grosor del cintillo */
  margin: 20px 0; /* Espaciado arriba y abajo del cintillo */
}
</style>
<div style="color: #003057;">
<hr style="border: 3px solid#0077C8;" />
<div id="siglas-y-acrónimos" class="section level1">
<h1>1. Siglas y acrónimos</h1>
<div class="two-columns">
<div class="column">
<p>
<strong>ACNUR.</strong> Oficina del Alto Comisionado de las Naciones
Unidas para los Refugiados.
</p>
<p>
<strong>AIC.</strong> Criterio de Información de Akaike.
</p>
<p>
<strong>BIC.</strong> Criterio de Información Bayesiano.
</p>
<p>
<strong>CCI.</strong> Corte Penal Internacional.
</p>
<p>
<strong>CEAVE.</strong> Comisión Ejecutiva de Atención a Víctimas del
Estado de Chihuahua.
</p>
<p>
<strong>CENSO 2020.</strong> Censo de Población y Vivienda 2020.
</p>
<p>
<strong>CMDPDH.</strong> Comisión Mexicana de Defensa y Promoción de los
Derechos Humanos.
</p>
<p>
<strong>CV.</strong> Coeficientes de Variación.
</p>
<p>
<strong>DFI.</strong> Desplazamiento Forzado Interno/Desplazada Forzada
Interna.
</p>
<p>
<strong>DP2.</strong> Índice de intensidad migratoria.
</p>
<p>
<strong>ECADEFI-CHIH.</strong> Encuesta para Caracterizar a la Población
en Situación de Desplazamiento Forzado Interno en el Estado de
Chihuahua.
</p>
<p>
<strong>EGRISS.</strong> Grupo de Expertos en Estadísticas sobre
Refugiados Desplazados Internos y Apátridas.
</p>
<p>
<strong>ENADID.</strong> Encuesta Nacional de la Dinámica Demográfica.
</p>
<p>
<strong>ENOE.</strong> Encuesta Nacional de Ocupación y Empleo.
</p>
</div>
<div class="column">
<p>
<strong>ENVIPE.</strong> Encuesta Nacional de Victimización y Percepción
sobre Seguridad Pública.
</p>
<p>
<strong>HFSSSD.</strong> Encuesta de Alta Frecuencia de Sudán del Sur.
</p>
<p>
<strong>ICTY.</strong> Tribunal Penal Internacional para la ex
Yugoslavia.
</p>
<p>
<strong>IDMC.</strong> Centro de Monitoreo de Desplazamiento Interno.
</p>
<p>
<strong>INE.</strong> Instituto Nacional de Estadística.
</p>
<p>
<strong>INEGI/Instituto.</strong> Instituto Nacional de Estadística y
Geografía.
</p>
<p>
<strong>IRIS.</strong> Recomendaciones Internacionales sobre
Estadísticas de Personas Desplazadas Internamente.
</p>
<p>
<strong>IRRS.</strong> Recomendaciones Internacionales sobre
Estadísticas de Refugiados.
</p>
<p>
<strong>JIPS.</strong> Joint IDP Profiling Service.
</p>
<p>
<strong>ONE.</strong> Oficinas nacionales de estadística.
</p>
<p>
<strong>PRINCIPIOS RECTORES.</strong> Principios Rectores de los
Desplazamientos Internos de la Organización de las Naciones Unidas.
</p>
<p>
<strong>SNIEG.</strong> Sistema Nacional de Información Estadística y
Geográfica.
</p>
<p>
<strong>SNIGSPIJ.</strong> Subsistema Nacional de Información sobre
Gobierno Seguridad Pública e Impartición de Justicia.
</p>
</div>
</div>
<br><br>
<hr style="border: 3px solid#0077C8;" />
</div>
<div id="integración-y-reconciliación" class="section level1">
<h1>2. Integración y reconciliación</h1>
<p>El EGRISS reconoce la complejidad de encontrar una única fuente de
datos que proporcione una imagen completa y precisa de la población en
situación DFI. Ante este desafío, el EGRISS (2023) propone la
integración de diversas fuentes de información como estrategia
fundamental para mejorar la cobertura, disponibilidad, frecuencia,
oportunidad, calidad y precisión de las estadísticas sobre DFI.</p>
<p>La integración de diferentes fuentes permite aprovechar las
fortalezas de cada una y compensar sus posibles limitaciones
individuales. Esto facilita la obtención de una visión más amplia y
confiable de la situación del DFI, incluyendo a grupos poblacionales
específicos que podrían quedar excluidos de una sola fuente. Además,
estas técnicas racionalizan las tareas de las Oficinas Nacionales de
Estadística (ONE) al enriquecer la información recopilada para producir
estadísticas sin aumentar costos ni la carga de respuesta de los
informantes (Naciones Unidas, 2020).</p>
<p>La integración de fuentes puede ofrecer una imagen más completa del
fenómeno, sobre todo en casos donde una encuesta tiene cobertura amplia
pero información limitada sobre variables de DFI, y otra tiene cobertura
limitada pero información más detallada sobre estas variables. La
integración de datos es especialmente útil cuando ninguna de las fuentes
cubre por completo ni de manera precisa a una población determinada,
cuando hay diferentes estimaciones para el mismo fenómeno, como es el
caso de las estadísticas sobre DFI en México, donde ninguna cifra ni
estimación coincide, sino que, por el contrario, difieren
considerablemente con se aprecia en la Tabla 3. Existen aproximaciones
nacionales y por entidad federativa, en el marco y fuera del marco del
del Sistema Nacional de Información Estadística y Geográfica
(SNIEG).</p>
<p>El SNIEG aborda el tema del DFI desde, al menos, dos de sus
subsistemas, desde el Subsistema Nacional de Información de Gobierno,
Seguridad Pública e Impartición de Justicia y desde el Subsistema de
Información Nacional de Información Demográfica. En el marco del primer
subsistema, la ENVIPE proporciona información sobre las personas que se
cambian de vivienda o lugar de residencia para protegerse de la
delincuencia. En el marco del segundo, la Encuesta Nacional de la
Dinámica Demográfica (ENADID) y el Censo 2020 permiten aproximarse al
DFI.</p>
<p>Esas fuentes tienen como objetivo recopilar información sobre temas
similares, como la migración por inseguridad pública, delictiva o
violencia, pero difieren en metodología de muestreo, diseño de
cuestionario, periodo de referencia y población objetivo.</p>
<p>Los métodos de estimación multifuente abordan desafíos específicos
asociados con la comparación y reconciliación de datos de diferentes
fuentes, como la alineación de categorías de variables, el manejo de
valores atípicos y la corrección de sesgos de cobertura. Esto puede
mejorar la calidad de las estimaciones y proporcionar una base más
sólida para la toma de decisiones y políticas públicas relacionadas con
la migración por violencia. Las técnicas de integración se dividen en
dos grandes tipos: de consolidación y vinculación. Las técnicas de
consolidación consisten en crear un conjunto unificado de datos, de esta
manera se consigue un mayor número de observaciones. Las técnicas de
vinculación, en cambio, se refieren a los procedimientos mediante los
que dos o más conjuntos de datos se unen a partir de una variable de
identificación única, llave o clave, de esta manera se consiguen más
atributos de las observaciones. En ambos casos las variables deben ser
seleccionadas, transformadas y cargadas (proceso ETL, por sus siglas en
inglés). A lo largo de este proceso es necesario verificar la coherencia
y armonización de los conjuntos de datos (Naciones Unidas 2020, l.
808).</p>
<p>Es de esperarse que entre fuentes haya diferencias en las
definiciones de variables, de ahí que a partir de los valores observados
disponibles es necesario estimar los valores para las variables objetivo
de acuerdo con la definición deseada, a este paso se le denomina
alineación de mediciones. Una vez realizadas la consolidación y
vinculación, es posible implementar diversos métodos de estimación, a
nivel micro y agregado. Cuando se trata de datos de encuesta se calculan
las ponderaciones mediante regresión para todas las observaciones del
nuevo conjunto de datos obtenido a partir de la integración (Naciones
Unidas 2020). Las ponderaciones originales de cada una de las encuestas
se ajustan calibrándolas, es decir, la ponderación de regresión se
calibra sobre estos valores conocidos o estimados previamente.</p>
</div>
</div>
<div class="row-sm-3">
<img src="imagenes/integraci%C3%B3n_diagrama_ONU_2020.png" /> </a>
</div>
<br><br>
<hr style="border: 3px solid#0077C8;" />
<div id="metodología" class="section level1">
<h1>3. Metodología</h1>
<p>A partir de la integración de datos de distintas fuentes, se siguen
diversas estrategias empíricas para estimar el número de personas en
situación de DFI asociado a la delincuencia, inseguridad y violencia.
Para estimar el número de personas en situación de DFI en México, se
consolidaron y armonizaron los conjuntos de datos de la ENVIPE 2018 y la
ENADID 2018. Basándose en las definiciones del EGRISS (2020, 2023), se
crearon variables para identificar a las personas en situación de DFI.
Los ponderadores de la muestra se calibraron para corregir posibles
sesgos y asegurar la representatividad de la población objetivo. Se
empleó el método de estimación Horvitz-Thompson para estimar el número
de personas en situación de DFI a nivel nacional y por entidad
federativa. Finalmente, se evaluó la confiabilidad de los resultados a
partir de la estimación de los coeficientes de variación (CV). Por otra
parte, se analizaron las macro determinantes de la emigración. Para
esto, se consideraron las emigraciones por razón de inseguridad
delictiva y violencia y por razones distintas a esta, tales como las
emigraciones por razones de trabajo, escuela o familia. Se utilizaron
datos agregados a nivel municipal del Censo 2020 y de las estadísticas
vitales. Se hicieron los cálculos para cada municipio y se establecieron
las variables auxiliares. Se estimaron modelos de regresión.</p>
<div
id="calibración-del-ponderador-en-integración-de-la-envipe-2018-y-enadid-2018"
class="section level2">
<h2>3.1. Calibración del ponderador en integración de la ENVIPE 2018 y
ENADID 2018</h2>
<p>Para estimar el número de personas en situación de DFI atribuido a la
violencia se emplearon métodos de integración de datos, se calibraron
los ponderadores, de esta manera, se ajustaron los pesos muestrales para
que las estimaciones del nuevo conjunto de datos integrado reflejen
adecuadamente a la población conocida. Esta técnica se informa de las
características conocidas de la población y de muestreos de base. Las
primeras se obtuvieron del Censo 2020; para los segundos se consultaron
y siguieron los marcos conceptuales y diseños muestrales de los
programas estadísticos utilizados (INEGI 2019c; 2020; 2019a; 2018b;
2019b) La disposición de una mayor información puede contribuir a
mejorar la precisión de los estimadores, reduciendo el error muestral y
los coeficientes de variación.</p>
<div id="datos" class="section level3">
<h3>3.1.1. Datos</h3>
<p>Se usaron datos de la ENVIPE 2018 y la ENADID 2018, por sus
similitudes en periodos de levantamiento de información y diseño
muestral. Con estos datos se llevó a cabo un proceso de preparación,
transformación y creación de variables de interés para ambas encuestas.
En el caso de la ENADID 2018 se unieron las tablas que componen su base
de datos, a partir de las llaves primarias. La base de datos de esta
encuesta se estructura en 4 tablas. Solo se unieron las tablas con las
variables de interés. En este caso se unieron la Tabla de hogares
(THogar) y la tabla de datos sociodemográficos de (TSDem). La primera
tabla THogar concentra información relativa a los hogares dentro de las
viviendas seleccionadas para la aplicación de la encuesta,
específicamente en esta tabla se incluyen la contabilización del número
de integrantes del hogar, de identificación, UPM, VIV_SEL, y consecutivo
del hogar; variables de Identificación Geográfica, ENT y TAM_LOC. Se
incluye un ponderador FAV_VIV y variables de estratificación. La tabla
THogar incluye dos variables de identificación única a nivel registro:
Llave de vivienda y Llave de hogar. La segunda tabla, TSDem, contiene
las variables de identificación upm, viv_sel, hogar, n_ren que sirven
para relacionar todas las tablas de la encuesta, así como variables de
identificación geográfica: la Entidad federativa (ent) y Tamaño de
localidad (tam_loc). Además, contiene variables de interés como: Sexo,
Edad, Entidad de residencia en 2017, Causa de migración reciente.</p>
<div id="procedimiento-de-estimación" class="section level4">
<h4>3.1.2. Procedimiento de estimación</h4>
<p>Lectura de la base de datos y selección de las columnas de
interés</p>
<table class="table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<caption>
Comparación de Características de Fuentes de Datos
</caption>
<thead>
<tr>
<th style="text-align:center;">
Características
</th>
<th style="text-align:center;">
ENVIPE_2018
</th>
<th style="text-align:center;">
ENADID_2018
</th>
<th style="text-align:center;">
Censo_2020
</th>
<th style="text-align:center;">
IDMC
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
Objetivo general
</td>
<td style="text-align:center;">
Estimar el número de víctimas y número de delitos ocurridos, cifra
negra, costos de delitos, percepción de inseguridad…
</td>
<td style="text-align:center;">
Proporcionar información estadística … de la dinámica demográfica:
fecundidad, mortalidad y migración (interna e internacional).
</td>
<td style="text-align:center;">
Producir información sobre la dimensión, estructura y distribución
espacial de la población
</td>
<td style="text-align:center;">
Proveer la Base de Datos Global sobre Desplazamientos Internos.
</td>
</tr>
<tr>
<td style="text-align:center;">
Periodo de referencia
</td>
<td style="text-align:center;">
Enero – diciembre para victimización.
</td>
<td style="text-align:center;">
Cinco años antes (agosto 2013).
</td>
<td style="text-align:center;">
Cinco años antes (marzo 2015).
</td>
<td style="text-align:center;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:center;">
Selección de la muestra
</td>
<td style="text-align:center;">
Probabilístico: trietápico, estratificado y por conglomerados.
</td>
<td style="text-align:center;">
Probabilístico, bietápico y por conglomerado estratificado.
</td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:center;">
Unidades de observación
</td>
<td style="text-align:center;">
Las viviendas seleccionadas, los hogares, los residentes del hogar y la
persona seleccionada en el hogar.
</td>
<td style="text-align:center;">
Vivienda particular habitada, residente habitual, Hogar, migrante
internacional, Mujer de 15 a 54 años.
</td>
<td style="text-align:center;">
<ul>
<li></td>
<td style="text-align:center;">
Hogares, Personas
</td>
</tr>
<tr>
<td style="text-align:center;">
Población objeto de estudio
</td>
<td style="text-align:center;">
Población de 18 años y más
</td>
<td style="text-align:center;">
Residente habitual del hogar, residentes habituales y migrantes
internacionales.
</td>
<td style="text-align:center;">
Residentes habituales del territorio nacional, las viviendas
particulares, y migrantes internacionales.
</td>
<td style="text-align:center;">
DFI
</td>
</tr>
<tr>
<td style="text-align:center;">
Periodo de levantamiento
</td>
<td style="text-align:center;">
Marzo - abril 2018
</td>
<td style="text-align:center;">
3 de agosto al 5 de octubre de 2018.
</td>
<td style="text-align:center;">
2 al 27 de marzo de 2020
</td>
<td style="text-align:center;">
<ul>
<li></td>
</tr>
<tr>
<td style="text-align:center;">
Cobertura geográfica
</td>
<td style="text-align:center;">
A nivel Nacional, Nacional urbano, Nacional rural, Entidad Federativa y
34 Áreas Metropolitanas de interés
</td>
<td style="text-align:center;">
Nacional (urbano de 2 500 habitantes y más, rural hasta 2 499
habitantes), entidad federativa y tamaños de localidad.
</td>
<td style="text-align:center;">
Nacional, entidad federativa, municipio o demarcación territorial,
localidad, AGEB, manzana urbana.
</td>
<td style="text-align:center;">
Mundial
</td>
</tr>
</tbody>
</table></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<p>Una vez que se unieron ambas tablas, se obtuvo un conjunto de datos a
nivel individual de 385,978 observaciones. A partir de este conjunto se
creó la variable emi_int_viol para identificar a las personas que
experimentaron un cambio de residencia entre la fecha del levantamiento
de la información y agosto de 2017 (un año atrás) y atribuyeron el
cambio a situaciones de inseguridad pública o violencia. Con fines de
validación, se estimó la población de 5 años y más de edad migrante
interna, por entidad federativa de residencia en agosto de 2013 según
causa de la migración. A partir del método de cálculo utilizado se llegó
al mismo resultado que el INEGI publica en los Tabulados. No se pudo
validar directamente la cifra de interés, es decir, la población de 5
años y más de edad migrante interna, por entidad federativa de
residencia en agosto de 2017 según causa de la migración ya que no es
parte de la información que se publica en los Tabulados. Para fines de
calibración, adicionalmente, se creó la variable edad_quin para
clasificar a los individuos en grupos quinquenales de edad, tomando como
base la variable continua de edad. Para poder unir esta base a la de la
ENVIPE, se renombraron las variables de manera que coincidieran.
Asimismo, se seleccionaron solo las variables iniciales de interés. La
base de datos de la ENVIPE 2021 se integra por 6 tablas, de las cuales
solo se necesitaron dos, Tabla de residentes del hogar (TSDem) y Tabla
de percepción sobre seguridad y desempeño institucional (TPer_Vic1). La
primera contiene las características sociodemográficas de los
integrantes del hogar y sirvió para conocer el número de integrantes de
cada hogar. La Tabla de percepción sobre seguridad y desempeño
institucional (TPer_Vic1) contiene información relacionada con la
percepción sobre seguridad pública en el ámbito geográfico del
informante, las conductas antisociales en su entorno inmediato y los
cambios de hábitos por temor a ser víctima de la delincuencia en 2017. A
partir de esta Tabla se identificaron los hogares que habían cambiado de
vivienda o residencia por temor a la delincuencia entre 2017 y la fecha
del levantamiento de la ENVIPE. Al igual que se hizo con la ENADID 2018,
se creó la variable emi_int_viol. En este caso, la variable identifica a
las personas que declararon haberse cambiado de vivienda o residencia
como medida de protección ante la delincuencia, dada a partir de la
variable original AP4_11_10. La variable emi_int_viol tomó el valor de 1
cuando AP4_11_10 tomó el valor de “1”, y 0 cuando AP4_11_10 tomó el
valor de “0”. Una vez que se obtuvieron las variables necesarias, ambas
tablas se unieron mediante el identificador de hogar (ID_HOG) y se
seleccionaron solo las 9 variables de interés. Se obtuvo un conjunto de
datos a nivel individual de 91,541 observaciones. La ENVIPE 2021 cuenta
con ocho factores de expansión, FAC_VIV, FAC_HOG, FAC_ELE, FAC_DEL,
FAC_VIV_AM, FAC_HOG_AM , FAC_ELE_AM y FAC_DEL_AM. El primero está
asociado a la vivienda (FAC_VIV), el segundo corresponde a los hogares
(FAC_HOG); el tercero está relacionado con las personas de 18 años y más
(FAC_ELE) y el cuarto expande cada delito captado en el módulo sobre
victimización (FAC_DEL). Además, debido al interés para obtener
estimaciones sobre determinados indicadores de la ENVIPE 2021 en
ciudades o áreas metropolitanas, se han añadido el factor vivienda de
área metropolitana (FAC_VIV_AM), el factor hogar de área metropolitana
(FAC_HOG_AM), el factor de personas elegidas en el área metropolitana
(FAC_ELE_AM) y el factor delito del área metropolitana (FAC_DEL_AM).
Estos cuatro factores son análogos a los asociados a los hogares, pero
ajustados a las 33 áreas metropolitanas que se detallan en la tabla
posterior (INEGI 2018a). El factor vivienda (FAC_VIV) es el ponderador
que se utiliza para estimar resultados de las preguntas que se refieren
a las viviendas y la población en general. El factor hogar (FAC_HOG) es
el ponderador que se utiliza para estimar resultados de las preguntas
que se refieren a los hogares y la población en general. El factor de
personas elegidas (FAC_ELE) es el ponderador para estimar resultados de
las preguntas de percepción de la seguridad pública y la victimización
de la población de 18 años y más. El factor delito es el ponderador que
se utiliza para estimar resultados de los delitos registrados en el
“Módulo de delitos”. Los factores con terminación _AM están ajustados
para las 33 áreas metropolitanas (INEGI, 2018a). De acuerdo con el Marco
conceptual de la ENVIPE 2018, la prevención y protección ante el delito
es uno de los componentes y aspectos conceptuales en las encuestas de
victimización. En este componente se incluyen preguntas sobre el tipo de
precauciones para protegerse o prevenir el delito. En la ENVIPE 2018 se
consideró que el cambio de rutinas es un importante indicador de
inseguridad porque es una manifestación real del temor a la delincuencia
que incide en la vida de las personas. Una de las medidas de protección
que considera es el cambio de vivienda, desde esta perspectiva, el
cambio de vivienda sería un proxy de temor al delito, es decir, una
medida indirecta de la variable de interés, delincuencia. Las variables
proxy son comúnmente utilizadas en estudios empíricos cuando la variable
de interés no puede ser observada directamente o cuando los datos
disponibles son limitados. Sin embargo, es importante tener en cuenta
que una variable proxy no siempre refleja con precisión la variable
subyacente que se intenta medir, y su uso conlleva limitaciones y
riesgos de sesgos. Considerando lo anterior y como primera aproximación,
se buscó determinar el número de hogares que, durante el año 2017,
tomaron medidas para protegerse de la delincuencia, como mudarse de
vivienda o residencia. La estimación inicial, basada en la pregunta de
la encuesta “¿Durante 2017, para protegerse de la delincuencia, ¿en este
hogar se realizó algún tipo de medida como cambiarse de vivienda o lugar
de residencia?”, arrojó un total de 315,330 hogares. Al tratarse de una
pregunta sobre la percepción de la seguridad pública, surge la
posibilidad de utilizar el factor de expansión de personas elegidas
(FAC_ELE) para realizar estimaciones poblacionales. Este método, sin
embargo, no coincide con los resultados publicados en los tabulados
oficiales. El estimador Horvitz-Thompson, basado en el FAC_ELE, estima
un total de 715 mil 971 personas que tomaron medidas para protegerse de
la delincuencia, mientras que los tabulados oficiales reportan un total
de un millón 133 mil 041 personas. Asimismo se buscó replicar el método
de cálculo del INEGI. Para conseguirlo, el factor de expansión que
corresponde a los hogares se multiplicó por el número de integrantes del
hogar y así se obtuvo un nuevo factor base de expansión. Este método
supone que todas las personas integrantes del hogar cambiaron de
vivienda o lugar de residencia por la misma razón y más o menos en las
mismas condiciones. Sin embargo, el EGRISS (2023) sugiere que no siempre
todos los integrantes de un hogar son personas en situación de DFI, sino
que las personas en dicha situación “pueden vivir en campamentos
exclusivos o en casas entre la población general, ya sea como parte de
otro hogar o como un hogar independiente” (EGRISS 2023c, 16).
Adicionalmente, la información sobre actitudes, intenciones de mudarse y
poder de toma de decisiones en el hogar puede variar según el género de
la persona informante. Para garantizar datos más confiables es
recomendable utilizar un protocolo de selección aleatoria de mujeres y
hombres encuestados dentro de un hogar muestreado, o entrevistar a más
de un miembro de cada hogar (EGRISS 2023c, 16). Por lo anterior, se
usaron dos factores de expansión base para la ENVIPE, FAC_ELE y
FAC_HOGAR multiplicado por el número de integrantes del hogar. A partir
de estos pesos base de la ENVIPE 2018 y de los pesos base de la ENADID
2018 se realizó la calibración. Para lograrlo, ambos conjuntos de datos
se integraron en uno solo, de manera vertical. Se obtuvo un solo
conjunto con 477 mil 519 observaciones y nueve variables.</p>
</div>
</div>
<div id="raking" class="section level3">
<h3>Raking</h3>
<p>Un método comúnmente utilizado de algoritmos de calibración es el
raking (también conocido como ajuste proporcional iterativo) (Deming y
Stephan 1940). Este método emplea el algoritmo de Newton- Raphson
(Deville y Sarndal 1992; Deville, Sarndal, y Sautory 1993). De acuerdo
con Deville, Sarndal, y Sautory (1993), este algoritmo ofrece una
solución general, eficiente y distinta de la versión clásica W. E.
Deming (ajuste proporcional iterativo). La diferencia, consiste en que
el primero es una generalización del segundo, busca la convergencia y
optimización mediante la minimización de la función de distancia entre
los pesos base u originales y los nuevos pesos. Para calcular los nuevos
pesos, se resuelven las ecuaciones de calibración. El muestreo
estratificado junto al ajuste proporcional iterativo, en particular,
preserva las ventajas de la estratificación (que puede basarse en
estratos geográficos) y de los recuentos de grupos de edad conocidos
(Deville, Sarndal, y Sautory 1993, 1015). El Instituto Nacional de
Estadísticas y Estudios Económicos (INSEE por sus siglas en francés),
agencia nacional de estadística francesa, desde 1940 emplea los métodos
raking de calibración para producir ponderaciones para encuestas de
hogares. Para esto desarrollaron el programa CALMAR de SAS. En este
trabajo, las ponderaciones se crearon con la función raking del paquete
survey de R (Lumley 2023), utilizando las distribuciones marginales de
las variables de ajuste derivadas de datos de población de CONAPO, se
usaron las categorías de los grupos quinquenales de edad y sexo y los
pesos (factores de expansión) originales. De acuerdo con INEGI (2019b)
los pesos son el inverso de la probabilidad de selección. Sin embargo,
al usar dos factores de expansión base para la ENVIPE 2018, se hicieron
dos recalibraciones y, por tanto, se obtuvieron dos resultados. Con los
nuevos pesos obtenidos mediante la recalibración, se obtuvieron los
estimadores Horvitz-Thompson del número de personas en situación de DFI
en el país y para cada entidad federativa, junto con sus varianzas,
errores y coeficientes de variación. A partir de estos últimos se evaluó
la calidad de los resultados. El INEGI categoriza la confiabilidad de
las estimaciones con base en los coeficientes de variación asociados
(INEGI 2021). Si el coeficiente de variación está entre 0% y 15%, los
datos se considera que tiene un alto grado de fiabilidad; si el
coeficiente de variación es superior o igual al 15 % e inferior al 30 %,
se considera que los datos tienen un grado tolerable de fiabilidad; y si
el coeficiente de variación es mayor o igual al 30%, los datos deben ser
recibidos con ciertas reservas debido a su baja confiabilidad. De esta
forma, la estimación de emigrantes que atribuyen a la inseguridad
pública y violencia el cambio de municipio de residencia entre marzo de
2015 y agostos de 2020 en México tuvo un alto nivel de confiabilidad.
Respecto a las estimaciones a nivel entidad federativa, 27 entidades
tuvieron estimaciones con un grado de confiabilidad tolerable y 5 con un
grado de confiabilidad bajo. Análisis de las macrodeterminantes de la
emigración<br />
Para estimar la tasa de personas que, en relación con la violencia,
cambiaron de municipio de residencia (por cada cien mil habitantes) se
configuraron las variables independiente y de control y se ajustaron
diversos modelos de regresión, lineal utilizando mínimos cuadrados
ordinarios (ols), rlm, errores espaciales, mínimos cuadrados
generalizados (gls), lineal ponderado y aditivo generalizado (gam). Se
puso a prueba un efecto no lineal de la violencia sobre el DFI.
Adicionalmente, se transformaron las variables dependiente e
independiente en logarítmicas y se suavizó la tasa promedio quinquenal
de homicidios municipales. La selección del modelo óptimo se basó en
pruebas de supuestos y criterios de información como el AIC (Criterio de
Información de Akaike) y BIC (Criterio de Información Bayesiano). La
variable dependiente es la tasa de personas que cambiaron de lugar de
residencia y atribuyeron la violencia como causa principal de dicho
cambio, por cada cien mil habitantes, durante el período 2015-2019
(tasa_dfi). Solo se consideraron los municipios al inicio del
quinquenio. Para lidiar con la heteroscedasticidad y anormalidad, esta
variable se transformó en su versión logarítmica más uno (log plus one)
. Considerando que entre 2015 y 2019 en más de la mitad de los
municipios del país no hubo un solo homicidio doloso y el logaritmo de
cero no está definido, se agregó una pequeña constante (como 1). A esto
se le suele denominar transformación “log más uno”. La estimación se
realizó a partir de la pregunta de lugar de residencia cinco años atrás,
la tasa de DFI se define como:</p>
<p>_=(Ii/POBi)×100,000</p>
<p>Donde: <em> : Tasa de DFI (intermunicipal) del municipio i de 2015 a
2019 por cada cien mil habitantes </em> : Personas en situación de DFI
del municipio i de 2015 a 2019 _ : Población total del municipio i a
mitad del periodo t a t+4 Para explorar más a fondo la variación de la
tasa de DFI por violencia, el Mapa XXX muestra su distribución
geográfica.</p>
<p>Figura 2. Tasa de personas que cambiaron de lugar de residencia y
atribuyeron a la violencia dicho cambio por cada cien mil habitantes,
2015-2019</p>
<p>La variable independiente es la violencia, se mide a partir de los
homicidios dolosos municipales ocurridos entre 2015 y 2019 por cada cien
mil habitantes (tasa_promedio_hom). A partir del recuento de los
homicidios dolosos de las estadísticas de mortalidad y de las
proyecciones de población, se estimaron las tasas brutas de homicidio
por cada cien mil habitantes. Para corregir la inestabilidad de la
varianza y, en consecuencia la generación de valores atípicos espurios,
producto de las diferencias en las poblaciones municipales, se recurrió
a un enfoque de suavizamiento usando el método empírico bayesiano (EB)
(Anselin et al. 2023). Este enfoque retoma la información previa de la
distribución de los homicidios y de la población, binomial y gamma,
respectivamente, para obtener una nueva estimación ajustada. La tasa
suavizada se expresa como un promedio ponderado de la tasa bruta, r, y
la estimación previa, θ. Esta última se estima como una tasa de
referencia, el promedio estatal. En esencia, la técnica EB consiste en
calcular un promedio ponderado entre la tasa bruta de cada municipio y
el promedio estatal, con ponderaciones proporcionales a la población
subyacente en riesgo. Es decir, los municipios pequeños (es decir, con
una pequeña población en riesgo) tenderán a que sus tasas se ajusten
considerablemente, mientras que en los municipios más grandes las tasas
apenas cambiarán. De manera formal:</p>
<p>_i^{EB}=w_ir_i+(1-w_i)  En esta expresión , los pesos son: w_i= donde
P_i es la población del municipio i. En el enfoque bayesiano empírico,
la media y la varianza ^2 previas son estimadas a partir de los datos.
La Figura 3 muestra la distribución de esta variable independiente
suavizada. Se aplicó una transformación adicional: el logaritmo de la
variable más uno, igual que la transformación realizada en la variable
dependiente.</p>
<p>Figura 3. Tasa suavizada promedio de homicidios, 2015-2019</p>
</div>
</div>
</div>
<div id="estimación-del-desplazamiento-forzado-interno-en-méxico"
class="section level1">
<h1>Estimación del Desplazamiento Forzado Interno en México</h1>
<p>En este taller, aprenderemos a realizar una estimación del
desplazamiento forzado interno (DFI) en México, utilizando datos de la
Encuesta Nacional de Victimización y Percepción sobre Seguridad Pública
(ENVIPE) y la Encuesta Nacional de la Dinámica Demográfica (ENADID). Nos
enfocaremos en la calibración de ponderadores y la creación de diseños
muestrales.</p>
<div id="entorno-de-trabajo-y-librerías" class="section level2">
<h2>1. Entorno de trabajo y librerías</h2>
<p>Primero, cargaremos las librerías necesarias para el análisis:</p>
<pre class="r"><code>rm(list=ls()); graphics.off(); options(scipen = 999)
paquetes &lt;- c(
  &quot;class&quot;, &quot;pscl&quot;, &quot;MASS&quot;, &quot;lmtest&quot;, &quot;sandwich&quot;, &quot;tseries&quot;, &quot;raster&quot;, &quot;sf&quot;, 
  &quot;rgdal&quot;, &quot;ggplot2&quot;, &quot;caret&quot;, &quot;hot.deck&quot;, &quot;broom&quot;, &quot;beepr&quot;, &quot;foreign&quot;, 
  &quot;readr&quot;, &quot;dplyr&quot;, &quot;janitor&quot;, &quot;survey&quot;, &quot;openxlsx&quot;, &quot;tidyverse&quot;, &quot;date&quot;, 
  &quot;data.table&quot;, &quot;questionr&quot;, &quot;readxl&quot;, &quot;writexl&quot;, &quot;PracTools&quot;, &quot;haven&quot;, 
  &quot;knitr&quot;, &quot;kableExtra&quot;
)
for (i in paquetes) {if (!require(i, character.only = TRUE)) {install.packages(i);library(i, character.only = TRUE)} else {library(i, character.only = TRUE)}}</code></pre>
<pre><code>function test() {
   console.log(&quot;This code will have a copy button to right of &quot;);
}</code></pre>
<div id="cargar-y-preparar-datos-de-enadid" class="section level3">
<h3>2. Cargar y preparar datos de ENADID</h3>
<p>En esta fase describe la limpieza de los datos y su preparación para
el análisis. Está formada por subprocesos que verifican, limpian y
transforman los datos de entrada, de modo que puedan analizarse. Leemos
y preparamos los datos de ENADID. Esto incluye la limpieza de variables
y la creación de nuevas variables necesarias para el análisis.</p>
<p>Empezamos cargando los datos de la <a
href="https://www.inegi.org.mx/contenidos/programas/enadid/2018/datosabiertos/conjunto_de_datos_enadid_2018_csv.zip">ENADID</a></p>
<pre class="r"><code># Cargar ENADID para integración
# Leer datos y asignarlos a objeto
enadid_thogar &lt;- read_csv(&quot;data/conjunto_de_datos_thogar_enadid_2018/conjunto_de_datos/conjunto_de_datos_thogar_enadid_2018.csv&quot;)
enadid_tsdem &lt;- read_csv(&quot;data/TSDem.csv&quot;)


# Unir conjunto de datos 
enadid &lt;- enadid_tsdem %&gt;% left_join(enadid_thogar) %&gt;% clean_names()</code></pre>
<pre class="r"><code># Renombrar y crear variables 
enadid &lt;- enadid %&gt;% 
  rename(cve_ent=ent)
enadid$p3_19ac &lt;- ifelse(enadid$p3_19ac == &quot;99&quot;, NA, enadid$p3_19ac)
enadid$p3_12ac &lt;- ifelse(enadid$p3_12ac == &quot;99&quot;, NA, enadid$p3_12ac)
enadid$edad &lt;- ifelse(enadid$edad == &quot;999&quot;, NA, enadid$edad)
enadid$edad &lt;- as.numeric(enadid$edad)
enadid$misma_res_5A &lt;- ifelse(enadid$cve_ent == enadid$p3_19ac, 1, 0)
enadid$misma_res &lt;- ifelse(enadid$cve_ent == enadid$p3_12ac, 1, 0)

# Se considera emigrante por inseguridad y violencia
enadid$emi_int_viol_5A &lt;- ifelse(enadid$p3_20 == 8 &amp; enadid$misma_res_5A == 0, 1, 0)
enadid$emi_int_viol &lt;- ifelse(enadid$p3_13== 8 &amp; enadid$misma_res == 0, 1, 0)


# Conversión a tipo numérico las variables de tipo factor y homologacion de nombre con ENVIPE
enadid$fac_ele &lt;- as.numeric(as.character(enadid$fac_viv))</code></pre>
<pre class="r"><code># Crear la variable de factor edad_quin con los niveles especificados

# Crear los cortes para definir los niveles de la variable edad_quin
cortes &lt;- c(0, 4, 9, 14, 19, 24, 29, 34, 39, 44, 49, 54, 59, 64, 130)

# Crear la variable factor edad_quin
enadid$edad_quin &lt;- cut(as.numeric(enadid$edad), breaks = cortes, labels = c(&quot;pob_00_04&quot;, &quot;pob_05_09&quot;, 
                                                                             &quot;pob_10_14&quot;, &quot;pob_15_19&quot;, &quot;pob_20_24&quot;, 
                                                                             &quot;pob_25_29&quot;, &quot;pob_30_34&quot;, &quot;pob_35_39&quot;, 
                                                                             &quot;pob_40_44&quot;, &quot;pob_45_49&quot;, &quot;pob_50_54&quot;, 
                                                                             &quot;pob_55_59&quot;, &quot;pob_60_64&quot;, &quot;pob_65_mm&quot;), include.lowest = TRUE)


enadid_int &lt;- enadid %&gt;% dplyr::select(edad, edad_quin, sexo, upm, upm_dis, est_dis, fac_ele, cve_ent, emi_int_viol)


# Conversión a tipo numérico las variables de tipo factor
enadid_int$sexo &lt;- as.factor(as.numeric(enadid_int$sexo))</code></pre>
</div>
<div id="preparar-datos-de-envipe" class="section level3">
<h3>3. Preparar datos de ENVIPE</h3>
<p>De manera similar, preparamos los datos de ENVIPE.</p>
<pre class="r"><code># Preparar ENVIPE
# Tablas que se usarán para los cálculos de Prevalencia Delictiva, Incidencia Delictiva y Cifra Negra
tsd &lt;- read.dbf(&quot;data/TSDem.dbf&quot;) # Tabla del Sociodemográfico
tpv1&lt;- read.dbf(&quot;data/TPer_Vic1.dbf&quot;) %&gt;% 
  dplyr::select(&quot;ID_VIV&quot;, &quot;ID_HOG&quot;, &quot;ID_PER&quot;, &quot;UPM&quot;, &quot;VIV_SEL&quot;, &quot;HOGAR&quot;, &quot;RESUL_H&quot;, &quot;R_SEL&quot;, &quot;SEXO&quot;, &quot;EDAD&quot;, &quot;AREAM&quot;, &quot;CVE_ENT&quot;, &quot;NOM_ENT&quot;, &quot;CVE_MUN&quot;, &quot;FAC_ELE&quot;, &quot;FAC_HOG&quot;, 
                &quot;DOMINIO&quot;, &quot;ESTRATO&quot;, &quot;EST_DIS&quot;, &quot;UPM_DIS&quot;, &quot;CVE_ENT&quot;, &quot;AP4_11_10&quot;) # Tabla Principal de Victimización 1</code></pre>
<pre class="r"><code># Conversión a tipo numérico las variables de tipo factor
tpv1$FAC_ELE &lt;- as.numeric(as.character(tpv1$FAC_ELE))
tpv1$FAC_HOG &lt;- as.numeric(as.character(tpv1$FAC_HOG))
tsd$FAC_HOG &lt;- as.numeric(as.character(tsd$FAC_HOG))


# Construcción de la variable de Entidad, se substrae los dos primeros dígitos de la variable UPM
tpv1$ENT &lt;- substr(tpv1$UPM,1,2)</code></pre>
<pre class="r"><code>#Crear llaves

# Unir bases
# Pegar 
int_hog &lt;- tsd %&gt;% 
  group_by(ID_HOG) %&gt;% 
  summarise(integrantes=n())

envipe &lt;- tpv1 %&gt;% 
  left_join(int_hog) %&gt;% 
  dplyr::select(-ends_with(&quot;.y&quot;)) %&gt;% 
  clean_names()</code></pre>
<pre class="r"><code># Construcción de las variables
# envipe$emi_int_viol &lt;- ifelse(envipe$ap4_11_10%in%&quot;1&quot;,1,0)
envipe$emi_int_viol &lt;- case_when(envipe$ap4_11_10==&quot;1&quot;~1, TRUE ~ 0)

# Crear los cortes para definir los niveles de la variable edad_quin
cortes &lt;- c(0, 4, 9, 14, 19, 24, 29, 34, 39, 44, 49, 54, 59, 64, 130)

# Crear la variable factor edad_quin
envipe$edad_quin &lt;- cut(as.numeric(envipe$edad), breaks = cortes, labels = c(&quot;pob_00_04&quot;, &quot;pob_05_09&quot;, 
                                                                             &quot;pob_10_14&quot;, &quot;pob_15_19&quot;, &quot;pob_20_24&quot;, 
                                                                             &quot;pob_25_29&quot;, &quot;pob_30_34&quot;, &quot;pob_35_39&quot;, 
                                                                             &quot;pob_40_44&quot;, &quot;pob_45_49&quot;, &quot;pob_50_54&quot;, 
                                                                             &quot;pob_55_59&quot;, &quot;pob_60_64&quot;, &quot;pob_65_mm&quot;), include.lowest = TRUE)

# Se genera un factor a partir del factor de expansion de hogar multiplicado por el número de habitantes promedio en 2017/ TAMAÑO DEL HOGAR (VER https://www.inegi.org.mx/contenidos/programas/enh/2017/doc/enh2017_resultados.pdf)
envipe &lt;- envipe %&gt;% 
  mutate(fac_ele=as.numeric(fac_hog)*integrantes)
# Seleccionar variables para integrar

envipe_int &lt;- envipe %&gt;% dplyr::select(edad, edad_quin, edad, sexo, upm, upm_dis, est_dis, fac_ele, cve_ent, emi_int_viol)

# Conversión a tipo numérico las variables de tipo factor
envipe_int$upm &lt;- as.character(as.factor(envipe_int$upm))
envipe_int$upm_dis &lt;- as.character(as.factor(envipe_int$upm_dis))
envipe_int$est_dis &lt;- as.character(as.factor(envipe_int$est_dis))
envipe_int$cve_ent &lt;- as.character(as.factor(envipe_int$cve_ent))</code></pre>
</div>
<div id="unir-bases-de-datos" class="section level3">
<h3>4. Unir bases de datos</h3>
<p>Unimos las bases de datos de ENADID y ENVIPE para la estimación
conjunta.</p>
<pre class="r"><code>## Unir bases
integrar &lt;- rbind(enadid_int, envipe_int) </code></pre>
<pre class="r"><code># 6. Calibración del ponderador
# Leer y unir bases de población
poblacion_municipal &lt;- bind_rows(
  read_csv(&quot;data/data_t5_conapo/base_municipios_final_datos_01.csv&quot;, locale = locale(encoding = &quot;latin1&quot;)),
  read_csv(&quot;data/data_t5_conapo/base_municipios_final_datos_02.csv&quot;, locale = locale(encoding = &quot;latin1&quot;))
) %&gt;% clean_names()

# Arreglar claves de los municipios
poblacion_municipal &lt;- poblacion_municipal %&gt;% 
  mutate(entidad = ifelse(nchar(clave_ent) == 1,
                          paste0(&quot;0&quot;, clave_ent), clave_ent),
         clave_2 = ifelse(nchar(clave) == 4,
                          paste0(&quot;0&quot;, clave), clave))


# Filtrar por año y grupo de edad
poblacion_municipal$year &lt;- poblacion_municipal$ano
pob_por_gpos_edad &lt;- poblacion_municipal %&gt;%
  filter(year == 2017)

# Calcular sumas por grupos
grupos &lt;- pob_por_gpos_edad %&gt;%
  group_by(edad_quin) %&gt;%
  summarise(poblacion = sum(pob))

sexo &lt;- pob_por_gpos_edad %&gt;%
  group_by(sexo) %&gt;%
  summarise(poblacion = sum(pob))

cve_ent &lt;- pob_por_gpos_edad %&gt;%
  group_by(entidad) %&gt;%
  summarise(poblacion = sum(pob))

total &lt;- pob_por_gpos_edad %&gt;%
  summarise(poblacion = sum(pob))
edad_quin &lt;- grupos[[2]]
sexo &lt;- sexo[[2]]
cve_ent &lt;- cve_ent[[2]]
N &lt;-  total[[1]]</code></pre>
<pre class="r"><code># Paso 2: Crear el diseño muestral
diseño &lt;- svydesign(
  ids = ~upm,
  strata = ~est_dis,
  weights = ~fac_ele,
  data = integrar,
  nest = TRUE
)
#options(survey.lonely.psu = &quot;adjust&quot;)

calibracion &lt;- calibrate(design = diseño,
                         formula = ~as.factor(edad_quin) + as.factor(sexo),
                         calfun = &quot;raking&quot;,
                         population = c(&quot;(Intercept)&quot; = N, edad_quin[-1], sexo[-1]))


integrar$fac_nuevo=weights(calibracion)</code></pre>
<pre class="r"><code># Paso 3: Crear el NUEVO diseño muestral
diseño2 &lt;- svydesign(
  ids = ~upm,
  strata = ~est_dis,
  weights = ~fac_nuevo,
  data = integrar,
  nest = TRUE
)
#options(survey.lonely.psu = &quot;adjust&quot;)</code></pre>
<pre class="r"><code># Cálculo del número de personas DFI por violencia
# Nacional
n_dfi_viol &lt;- svytotal(~emi_int_viol, diseño2, na.rm = TRUE) 
# Entidad federativa
e_dfi_viol &lt;- svyby(~emi_int_viol, by=~cve_ent, diseño2, 
                    svytotal, na.rm = TRUE) 

# Estimaciones, Error estándar, Coeficiente de variación, Intervalos de confianza
# Nacional
est_n_dfi_viol &lt;- n_dfi_viol[[1]]
se_n_dfi_viol&lt;- SE(n_dfi_viol)
cv_n_dfi_viol &lt;- cv(n_dfi_viol)*100
li_n_dfi_viol &lt;- confint(n_dfi_viol,level=0.90)[1,1]
ls_n_dfi_viol &lt;- confint(n_dfi_viol,level=0.90)[1,2]
# Entidad federativa
est_e_dfi_viol&lt;- e_dfi_viol[[2]]
se_e_dfi_viol &lt;- SE(e_dfi_viol)
cv_e_dfi_viol &lt;- cv(e_dfi_viol)*100
li_e_dfi_viol &lt;- confint(e_dfi_viol,level=0.90)[,1]
ls_e_dfi_viol &lt;- confint(e_dfi_viol,level=0.90)[,2]


# Formato #
Entidades&lt;-c(&quot;Estados Unidos Mexicanos&quot;, &quot;Aguascalientes&quot;, &quot;Baja California&quot;, &quot;Baja California Sur&quot;, 
             &quot;Campeche&quot;, &quot;Coahuila de Zaragoza&quot;, &quot;Colima&quot;, &quot;Chiapas&quot;, &quot;Chihuahua&quot;, &quot;Ciudad de México&quot;, 
             &quot;Durango&quot;, &quot;Guanajuato&quot;, &quot;Guerrero&quot;, &quot;Hidalgo&quot;, &quot;Jalisco&quot;, &quot;Estado de México&quot;, 
             &quot;Michoacán de Ocampo&quot;, &quot;Morelos&quot;, &quot;Nayarit&quot;, &quot;Nuevo León&quot;, &quot;Oaxaca&quot;, &quot;Puebla&quot;, &quot;Querétaro&quot;, 
             &quot;Quintana Roo&quot;, &quot;San Luis Potosí&quot;, &quot;Sinaloa&quot;, &quot;Sonora&quot;, &quot;Tabasco&quot;, &quot;Tamaulipas&quot;, &quot;Tlaxcala&quot;, 
             &quot;Veracruz de Ignacio de la Llave&quot;, &quot;Yucatán&quot;, &quot;Zacatecas&quot;) 


est_dfi_viol &lt;- data.frame(Entidades, est_dfi_viol = round(as.numeric(c(est_n_dfi_viol, est_e_dfi_viol)), 0))
se_dfi_viol &lt;- data.frame(Entidades, se_dfi_viol = round(as.numeric(c(se_n_dfi_viol, se_e_dfi_viol)), 0))
cv_dfi_viol &lt;- data.frame(Entidades, cv_dfi_viol = round(as.numeric(c(cv_n_dfi_viol, cv_e_dfi_viol)), 2))
lim_dfi_viol &lt;- data.frame(Entidades, 
                           linf_dfi_viol = as.integer(c(li_n_dfi_viol, li_e_dfi_viol)),
                           lsup_dfi_viol = as.integer(c(ls_n_dfi_viol, ls_e_dfi_viol)))

# Elimina los nombres de fila
row.names(est_dfi_viol) &lt;- row.names(se_dfi_viol) &lt;- row.names(cv_dfi_viol) &lt;- 
  row.names(lim_dfi_viol) &lt;- NULL

# Exportar salida a un archivo de Excel #
# Lista de estimaciones
list_of_datasets &lt;- list(&quot;Estimaciones&quot; = est_dfi_viol, 
                         &quot;Error Estandar&quot; = se_dfi_viol, 
                         &quot;Coef Variacion&quot; = cv_dfi_viol, 
                         &quot;Int Confianza&quot; = lim_dfi_viol)</code></pre>
<pre class="r"><code>write.xlsx(list_of_datasets, 
           file = paste0(&quot;DFI_viol_envipe_enadid_FAC_HOG_&quot;, format(Sys.Date(), &quot;%y%m%d&quot;), &quot;.xlsx&quot;))

#################################################################################################################################################

## B. MÉTODO DE CÁLCULO USANDO FAC_ELE == fac_ele

# rm(list=ls()); graphics.off(); options(scipen = 999)
# paquetes=c(&quot;tidyverse&quot;, &quot;date&quot;, &quot;data.table&quot;, &quot;questionr&quot;, &quot;readxl&quot;, &quot;writexl&quot;, &quot;openxlsx&quot;, &quot;foreign&quot;, &quot;survey&quot;, &quot;PracTools&quot;, &quot;haven&quot;,&quot;knitr&quot;,&quot;kableExtra&quot;)
# for (i in paquetes) {if (!require(i, character.only = TRUE)) {install.packages(i);library(i, character.only = TRUE)} else {library(i, character.only = TRUE)}}

# Cargar ENADID para integración
# Leer datos y asignarlos a objeto
enadid_thogar &lt;- read_csv(&quot;data/conjunto_de_datos_thogar_enadid_2018/conjunto_de_datos/conjunto_de_datos_thogar_enadid_2018.csv&quot;)
enadid_tsdem &lt;- read_csv(&quot;data/TSDem.csv&quot;)


# Unir conjunto de datos 
enadid &lt;- enadid_tsdem %&gt;% left_join(enadid_thogar) %&gt;% clean_names()

# Renombrar y crear variables 
enadid &lt;- enadid %&gt;% 
  rename(cve_ent=ent)
enadid$p3_19ac &lt;- ifelse(enadid$p3_19ac == &quot;99&quot;, NA, enadid$p3_19ac)
enadid$p3_12ac &lt;- ifelse(enadid$p3_12ac == &quot;99&quot;, NA, enadid$p3_12ac)
enadid$edad &lt;- ifelse(enadid$edad == &quot;999&quot;, NA, enadid$edad)
enadid$edad &lt;- as.numeric(enadid$edad)
enadid$misma_res_5A &lt;- ifelse(enadid$cve_ent == enadid$p3_19ac, 1, 0)
enadid$misma_res &lt;- ifelse(enadid$cve_ent == enadid$p3_12ac, 1, 0)

# Se considera emigrante por inseguridad y violencia
enadid$emi_int_viol_5A &lt;- ifelse(enadid$p3_20 == 8 &amp; enadid$misma_res_5A == 0, 1, 0)
enadid$emi_int_viol &lt;- ifelse(enadid$p3_13== 8 &amp; enadid$misma_res == 0, 1, 0)


# Conversión a tipo numérico las variables de tipo factor y homologacion de nombre con ENVIPE
enadid$fac_ele &lt;- as.numeric(as.character(enadid$fac_viv))

# Crear la variable de factor edad_quin con los niveles especificados

# Crear los cortes para definir los niveles de la variable edad_quin
cortes &lt;- c(0, 4, 9, 14, 19, 24, 29, 34, 39, 44, 49, 54, 59, 64, 130)

# Crear la variable factor edad_quin
enadid$edad_quin &lt;- cut(as.numeric(enadid$edad), breaks = cortes, labels = c(&quot;pob_00_04&quot;, &quot;pob_05_09&quot;, 
                                                                             &quot;pob_10_14&quot;, &quot;pob_15_19&quot;, &quot;pob_20_24&quot;, 
                                                                             &quot;pob_25_29&quot;, &quot;pob_30_34&quot;, &quot;pob_35_39&quot;, 
                                                                             &quot;pob_40_44&quot;, &quot;pob_45_49&quot;, &quot;pob_50_54&quot;, 
                                                                             &quot;pob_55_59&quot;, &quot;pob_60_64&quot;, &quot;pob_65_mm&quot;), include.lowest = TRUE)


enadid_int &lt;- enadid %&gt;% dplyr::select(edad, edad_quin, sexo, upm, upm_dis, est_dis, fac_ele, cve_ent, emi_int_viol)


# Conversión a tipo numérico las variables de tipo factor
enadid_int$sexo &lt;- as.factor(as.numeric(enadid_int$sexo))
# Preparar ENVIPE
# Tablas que se usarán para los cálculos de Prevalencia Delictiva, Incidencia Delictiva y Cifra Negra
envipe &lt;- read.dbf(&quot;data/TPer_Vic1.dbf&quot;) %&gt;%
  dplyr::select(&quot;ID_VIV&quot;, &quot;ID_HOG&quot;, &quot;ID_PER&quot;, &quot;UPM&quot;, &quot;VIV_SEL&quot;, &quot;HOGAR&quot;, &quot;RESUL_H&quot;, &quot;R_SEL&quot;, &quot;SEXO&quot;, &quot;EDAD&quot;, &quot;AREAM&quot;, &quot;CVE_ENT&quot;, &quot;NOM_ENT&quot;, &quot;CVE_MUN&quot;, &quot;FAC_ELE&quot;, &quot;FAC_HOG&quot;,
                &quot;DOMINIO&quot;, &quot;ESTRATO&quot;, &quot;EST_DIS&quot;, &quot;UPM_DIS&quot;, &quot;CVE_ENT&quot;, &quot;AP4_11_10&quot;) # Tabla Principal de Victimización 1

# Conversión a tipo numérico las variables de tipo factor
envipe$FAC_ELE &lt;- as.numeric(as.character(envipe$FAC_ELE))


# Construcción de la variable de Entidad, se substrae los dos primeros dígitos de la variable UPM
envipe$ENT &lt;- substr(envipe$UPM,1,2)
envipe &lt;- envipe %&gt;% clean_names()

#Crear llaves

# Construcción de las variables
# envipe$emi_int_viol &lt;- ifelse(envipe$ap4_11_10%in%&quot;1&quot;,1,0)
envipe$emi_int_viol &lt;- case_when(envipe$ap4_11_10==&quot;1&quot;~1, TRUE ~ 0)

# Crear los cortes para definir los niveles de la variable edad_quin
cortes &lt;- c(0, 4, 9, 14, 19, 24, 29, 34, 39, 44, 49, 54, 59, 64, 130)

# Crear la variable factor edad_quin
envipe$edad_quin &lt;- cut(as.numeric(envipe$edad), breaks = cortes, labels = c(&quot;pob_00_04&quot;, &quot;pob_05_09&quot;,
                                                                             &quot;pob_10_14&quot;, &quot;pob_15_19&quot;, &quot;pob_20_24&quot;,
                                                                             &quot;pob_25_29&quot;, &quot;pob_30_34&quot;, &quot;pob_35_39&quot;,
                                                                             &quot;pob_40_44&quot;, &quot;pob_45_49&quot;, &quot;pob_50_54&quot;,
                                                                             &quot;pob_55_59&quot;, &quot;pob_60_64&quot;, &quot;pob_65_mm&quot;), include.lowest = TRUE)

# Seleccionar variables para integrar
envipe_int &lt;- envipe %&gt;% dplyr::select(edad, edad_quin, edad, sexo, upm, upm_dis, est_dis, fac_ele, cve_ent, emi_int_viol)

# Conversión a tipo numérico las variables de tipo factor
envipe_int$upm &lt;- as.character(as.factor(envipe_int$upm))
envipe_int$upm_dis &lt;- as.character(as.factor(envipe_int$upm_dis))
envipe_int$est_dis &lt;- as.character(as.factor(envipe_int$est_dis))
envipe_int$cve_ent &lt;- as.character(as.factor(envipe_int$cve_ent))

## Unir bases
integrar &lt;- rbind(enadid_int, envipe_int)

# 6. Calibración del ponderador
# Leer y unir bases de población
poblacion_municipal &lt;- bind_rows(
  read_csv(&quot;data/data_t5_conapo/base_municipios_final_datos_01.csv&quot;, locale = locale(encoding = &quot;latin1&quot;)),
  read_csv(&quot;data/data_t5_conapo/base_municipios_final_datos_02.csv&quot;, locale = locale(encoding = &quot;latin1&quot;))
) %&gt;% clean_names()

# Arreglar claves de los municipios
poblacion_municipal &lt;- poblacion_municipal %&gt;%
  mutate(entidad = ifelse(nchar(clave_ent) == 1,
                          paste0(&quot;0&quot;, clave_ent), clave_ent),
         clave_2 = ifelse(nchar(clave) == 4,
                          paste0(&quot;0&quot;, clave), clave))


# Filtrar por año y grupo de edad
poblacion_municipal$year &lt;- poblacion_municipal$ano
pob_por_gpos_edad &lt;- poblacion_municipal %&gt;%
  filter(year == 2017)

# Calcular sumas por grupos
grupos &lt;- pob_por_gpos_edad %&gt;%
  group_by(edad_quin) %&gt;%
  summarise(poblacion = sum(pob))

sexo &lt;- pob_por_gpos_edad %&gt;%
  group_by(sexo) %&gt;%
  summarise(poblacion = sum(pob))

cve_ent &lt;- pob_por_gpos_edad %&gt;%
  group_by(entidad) %&gt;%
  summarise(poblacion = sum(pob))

total &lt;- pob_por_gpos_edad %&gt;%
  summarise(poblacion = sum(pob))


edad_quin &lt;- grupos[[2]]
sexo &lt;- sexo[[2]]
cve_ent &lt;- cve_ent[[2]]
N &lt;-  total[[1]]

# Paso 2: Crear el diseño muestral
diseño &lt;- svydesign(
  ids = ~upm,
  strata = ~est_dis,
  weights = ~fac_ele,
  data = integrar,
  nest = TRUE
)
#options(survey.lonely.psu = &quot;adjust&quot;)

calibracion &lt;- calibrate(design = diseño,
                         formula = ~as.factor(edad_quin) + as.factor(sexo),
                         calfun = &quot;raking&quot;,
                         population = c(&quot;(Intercept)&quot; = N, edad_quin[-1], sexo[-1]))


integrar$fac_nuevo=weights(calibracion)

# Paso 3: Crear el NUEVO diseño muestral
diseño2 &lt;- svydesign(
  ids = ~upm,
  strata = ~est_dis,
  weights = ~fac_nuevo,
  data = integrar,
  nest = TRUE
)
#options(survey.lonely.psu = &quot;adjust&quot;)

# Cálculo del número de personas DFI por violencia
# Nacional
n_dfi_viol &lt;- svytotal(~emi_int_viol, diseño2, na.rm = TRUE) 
# Entidad federativa
e_dfi_viol &lt;- svyby(~emi_int_viol, by=~cve_ent, diseño2, 
                    svytotal, na.rm = TRUE) 

# Estimaciones, Error estándar, Coeficiente de variación, Intervalos de confianza
# Nacional
est_n_dfi_viol &lt;- n_dfi_viol[[1]]
se_n_dfi_viol&lt;- SE(n_dfi_viol)
cv_n_dfi_viol &lt;- cv(n_dfi_viol)*100
li_n_dfi_viol &lt;- confint(n_dfi_viol,level=0.90)[1,1]
ls_n_dfi_viol &lt;- confint(n_dfi_viol,level=0.90)[1,2]
# Entidad federativa
est_e_dfi_viol&lt;- e_dfi_viol[[2]]
se_e_dfi_viol &lt;- SE(e_dfi_viol)
cv_e_dfi_viol &lt;- cv(e_dfi_viol)*100
li_e_dfi_viol &lt;- confint(e_dfi_viol,level=0.90)[,1]
ls_e_dfi_viol &lt;- confint(e_dfi_viol,level=0.90)[,2]


# Formato #
Entidades&lt;-c(&quot;Estados Unidos Mexicanos&quot;, &quot;Aguascalientes&quot;, &quot;Baja California&quot;, &quot;Baja California Sur&quot;, 
             &quot;Campeche&quot;, &quot;Coahuila de Zaragoza&quot;, &quot;Colima&quot;, &quot;Chiapas&quot;, &quot;Chihuahua&quot;, &quot;Ciudad de México&quot;, 
             &quot;Durango&quot;, &quot;Guanajuato&quot;, &quot;Guerrero&quot;, &quot;Hidalgo&quot;, &quot;Jalisco&quot;, &quot;Estado de México&quot;, 
             &quot;Michoacán de Ocampo&quot;, &quot;Morelos&quot;, &quot;Nayarit&quot;, &quot;Nuevo León&quot;, &quot;Oaxaca&quot;, &quot;Puebla&quot;, &quot;Querétaro&quot;, 
             &quot;Quintana Roo&quot;, &quot;San Luis Potosí&quot;, &quot;Sinaloa&quot;, &quot;Sonora&quot;, &quot;Tabasco&quot;, &quot;Tamaulipas&quot;, &quot;Tlaxcala&quot;, 
             &quot;Veracruz de Ignacio de la Llave&quot;, &quot;Yucatán&quot;, &quot;Zacatecas&quot;) 


est_dfi_viol &lt;- data.frame(Entidades, est_dfi_viol = round(as.numeric(c(est_n_dfi_viol, est_e_dfi_viol)), 0))
se_dfi_viol &lt;- data.frame(Entidades, se_dfi_viol = round(as.numeric(c(se_n_dfi_viol, se_e_dfi_viol)), 0))
cv_dfi_viol &lt;- data.frame(Entidades, cv_dfi_viol = round(as.numeric(c(cv_n_dfi_viol, cv_e_dfi_viol)), 2))
lim_dfi_viol &lt;- data.frame(Entidades, 
                           linf_dfi_viol = as.integer(c(li_n_dfi_viol, li_e_dfi_viol)),
                           lsup_dfi_viol = as.integer(c(ls_n_dfi_viol, ls_e_dfi_viol)))


# Elimina los nombres de fila
row.names(est_dfi_viol) &lt;- row.names(se_dfi_viol) &lt;- row.names(cv_dfi_viol) &lt;- 
  row.names(lim_dfi_viol) &lt;- NULL

# Exportar salida a un archivo de Excel #
# Lista de estimaciones
list_of_datasets &lt;- list(&quot;Estimaciones&quot; = est_dfi_viol, 
                         &quot;Error Estandar&quot; = se_dfi_viol, 
                         &quot;Coef Variacion&quot; = cv_dfi_viol, 
                         &quot;Int Confianza&quot; = lim_dfi_viol)


write.xlsx(list_of_datasets, 
           file = paste0(&quot;DFI_viol_envipe_enadid_FAC_ELE_&quot;, format(Sys.Date(), &quot;%y%m%d&quot;), &quot;.xlsx&quot;))</code></pre>
</div>
</div>
</div>

document.addEventListener("DOMContentLoaded", function() {
  console.log("JavaScript cargado correctamente."); // Esto se debería mostrar en la consola si el JS se carga correctamente.
  
  document.querySelectorAll("pre").forEach(function(block) {
    console.log("Bloque de código encontrado:", block); // Esto muestra cada bloque de código encontrado.
    
    var copyButton = document.createElement("button");
    copyButton.className = "copy-button";
    copyButton.textContent = "Copiar";

    var codeContainer = document.createElement("div");
    codeContainer.className = "code-container";

    block.parentNode.insertBefore(codeContainer, block);
    codeContainer.appendChild(block);
    codeContainer.appendChild(copyButton);

    copyButton.addEventListener("click", function() {
      var code = block.innerText;

      var tempTextArea = document.createElement("textarea");
      tempTextArea.value = code;
      document.body.appendChild(tempTextArea);
      tempTextArea.select();
      document.execCommand("copy");
      document.body.removeChild(tempTextArea);

      copyButton.textContent = "¡Copiado!";
      setTimeout(function() {
        copyButton.textContent = "Copiar";
      }, 2000);
    });
  });
});


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
